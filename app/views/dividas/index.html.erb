<section class="content-header">
    <h1>
      <!--Mensagens aqui-->
      <%if notice %>
       <!-- <div class="alert alert-success alert-dismissable">
          <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
            <h4>  <i class="icon fa fa-check"></i>Mensagem</h4>
          <%#= notice %>
      </div> -->
      <%end%>
    <!--<small></small>-->
    </h1>

    <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#myModalDespesa">
      <span class='glyphicon glyphicon-plus' aria-hidden='true'></span> Nova despesa
    </button>

</section>

<section class="content">
  <div class="box">
              <div class="box-header">
                  <h3 class="box-title">Despesas</h3>
                </div><!-- /.box-header -->
                <div class="box-body">
                  <table id="example1" class="table table-bordered table-hover table-responsive table-condensed">
                    <thead>
                      <tr>
                        <th>Data Vencimento</th>
                        <th>Valor</th>
                        <th>Data Pagamento</th>
                        <th>CPF/CPNJ</th>
                        <th style="text-align:center">Ações</th>
                      </tr>
                    </thead>
                    <tbody id="tborcamento">

                    </tbody>
                    <!-- <tfoot>
                      <tr>
                        <th>Data Vencimento</th>
                        <th>Valor</th>
                        <th>Data Pagamento</th>
                        <th>CPF/CPNJ</th>
                        <th style="text-align:center">Ações</th>
                      </tr>
                    </tfoot> -->
                  </table>
                </div><!-- /.box-body -->
          </div><!-- /.box -->
</section>


<div id="myModalDespesa" class="modal fade" role="dialog">
  <div class="modal-dialog modal-lg">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h3 class="modal-title">Cadastro Despesas</h3>
      </div>
      <div class="modal-body">

        <div class="row">
           <div class="col-md-6">
              <div class="row">
                <div class="col-lg-4">
                 Nota Fiscal <br>
                 <input type="text" name="numr_notafiscal" id="numr_notafiscal" class="form-control">
                </div>
              </div>
              <div class="row">
                <div class="col-lg-8">
                  <label class="radio-inline"><input type="radio" onclick="seta_tipodivida(this.value)" value="1" name="optradio">Cheque</label>
                  <label class="radio-inline"><input type="radio" onclick="seta_tipodivida(this.value)" value="2" name="optradio">Boleto</label>
                  <label class="radio-inline"><input type="radio" onclick="seta_tipodivida(this.value)" value="3" name="optradio">Recibo</label><br>

                  <input type="hidden" id="numr_tipodivida" name="numr_tipodivida">
               </div>
             </div>
             <div class="row">
               <div class="col-lg-4">
                 <input type="text" name="numr_cheque" id="numr_cheque" class="form-control">
               </div>
             </div>
             <div class="row">
               <div class="col-lg-12">
                 Conta<br>
                 <%=select_tag "contabank_id", options_from_collection_for_select(Contabank.all, "id", "nome_banco"),{:class => 'form-control'}%>
                </div>
            </div>
            <div class="row">
              <div class="col-lg-4">
                Valor(R$) Total<br>
                <input type="txt" name="valr_divida" id="valr_divida" class="form-control">
              </div>
              <div class="col-lg-4">
                Data Vencimento<br>
                <input type="txt" name="data_vencimento" id="data_vencimento" class="form-control">
              </div>
              <div class="col-lg-3">
                Qtd. Folhas<br>
                <input type="txt" name="qtd_folhas" id="qtd_folhas" class="form-control">
              </div>
              <div class="col-lg-1">
                <div class="checkbox">
                  <label><input type="checkbox" id="flag_despesafixa" name="flag_despesafixa">D.Fixa</label>
                </div>
              </div>
            </div>
         </div>

         <div class="col-md-6">
            <div class="row">
              <div class="col-lg-12">
                 Prestador<br>
                <input type="text" name="nome_prestador"  id="nome_prestador" class="form-control">
                <input type="hidden" id="prestador_id">
             </div>
            </div>
            <div class="row">
              <div class="col-lg-12">
                 Item<br>
                <%=select_tag "item_id", options_from_collection_for_select(Titulo.where(numr_tipolancamento: 1), "id", "desc_titulo"),{:class => 'form-control'}%>
               </div>
           </div>
           <div class="row">
             <div class="col-lg-12">
               SubItem<br>
               <%=select_tag "subitem_id", options_from_collection_for_select(Titulo.where(numr_tipolancamento: 2), "id", "desc_titulo"),{:class => 'form-control'}%>
              </div>
          </div>
           <div class="row">
             <div class="col-lg-5">
             </div>
             <div class="col-lg-7">
               <div class="checkbox">
                 <label><input type="checkbox" id="flag_ordinaria" name="flag_ordinaria">D O - Despesas ORDINÁRIA</label>
               </div>
             </div>
           </div>
         </div>
      </div>

      </div>
      <div class="modal-footer">
        <div class="row">
          <div class="col-lg-1">
            <button type="button" class="btn btn-success" onclick="Salva()" data-dismiss="modal">Salvar</button>
         </div>
         <div class="col-lg-10">
         </div>
         <div class="col-lg-1">
            <button type="button" class="btn btn-danger" data-dismiss="modal">Sair</button>
         </div>
       </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">


jQuery(function($){
  $("#data_vencimento").mask("99/99/9999");
 });

   function Salva(){
    $.ajax({
      url: '<%= incluirDivida_path %>',
      data : {
        numr_tipodivida: $('#numr_tipodivida').val(),
        numr_cheque: $('#numr_cheque').val(),
        valr_divida: $('#valr_divida').val(),
        data_vencimento: $('#data_vencimento').val(),
        qtd_folhas:  $('#qtd_folhas').val(),
        prestador_id: $('#prestador_id').val(),
        item_id: $('#item_id').val(),
        subitem_id: $('#subitem_id').val(),
        flag_ordinaria: $('#flag_ordinaria').is(':checked'),
        flag_despesafixa: $('#flag_despesafixa').is(':checked'),
        contabank_id: $('#contabank_id').val()
      },
      success: function(data){
        var html = "";
        for (var i in data) {
          var item = data[i];
          html += "<td>"+item.data_vencimento+"</td>";
          html += "<td>"+item.valor+"</td>";
          html += "<td>"+item.data_pagamento+"</td>";
          html += "<td>"+item.data_vencimento+"</td>";
          html += "<td>"+item.cpf_cnpj+"</td>";
          html += "<td Align='right'>";
          html += " <button type='button' onclick='confirmeExclusao("+item.id+")' class='btn btn-danger btn-xs' aria-label='Left Align'>";
          html += "  <span class='glyphicon glyphicon-trash' aria-hidden='true'></span></button>";
        };

         html =  "<tr>" + html + "</tr>"
         $( "#tborcamento" ).append(html);
      }
    })
  }

  $(document).ready(function() {
       $('#nome_prestador').autocomplete({
       source: '/buscaprestador',
       dataType: 'json',
       minLength: 0,
       change: function(event, ui) {
       if (!ui.item) {
         $('#nome_prestador').val('');
       }
    },
    select: function(event, ui) {
        if (ui.item) {
              $("#prestador_id").val(ui.item.id);
           }
         }
     });
  });

  function seta_tipodivida(id){
    $('#numr_tipodivida').val(id);
  }


  $(function() {
   $("#valr_divida").maskMoney({showSymbol:true, symbol:"R$", decimal:",", thousands:"."});
 })

</script>


<style type="text/css">
  .ui-autocomplete {
      z-index: 5000;
  }
</style>
